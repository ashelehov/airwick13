<H1>Проект по переделке освежителя воздуха Airwick.</H1>
<p>Основное назначение переделки: увеличить интервалы между срабатываниями освежителя и добавить интерактивность (исключить срабатывание освежителя при нахождении человека в помещении и выполнить срабатывание после того, как человек покинет помещение, при условии, что человек там находился достаточно долго).</p>
<p>В качестве контроллера используется Attiny 13A, как одна из самых дешевых и распространенных МК. В качестве датчика света используется красный светодиод в прозрачном корпусе. Работа датчика основана на способности светодиода накапливать заряд (паразитная емкость). Кроме того светодиод выполняет свои прямые обязанности, используется в качестве индикатора работы устройства.</p>
<p>В режиме покоя схема потребляет 6-7 микроампер. Раз в 8 секунд контроллер просыпается, опрашивает датчик. После этого на 1 мс вспыхивает светодиод. Двигатель включается на 500 мс, дальше крутится по инерции, обратно его крутит клапан баллона. Средний потребляемый ток двигателя 100 миллиампер. При таком режиме алкалиновых батарей хватит надолго.</p>
<H2>Алгоритм работы устройства:</H2>
1) «пшикаем» через равные промежутки времени, напр. раз в час, при условии, что свет выключен то есть в помещении никого нет.<br>
2) если свет включается, запускаем таймер.<br>
3) когда свет выключается:<br>
  1. если прошло мало времени (напр. меньше 2.5 минут), пшикать не надо.<br>
  2. если прошло больше, «пшикаем» и сбрасываем таймер.<br>
Если после последнего срабатывания прошло меньше 15 минут, то не «пшикаем», так как аэрозоль еще не выветрился.<br>
4) если свет долго не выключается (напр. больше часа), значит забыли выключить, продолжаем брызгать.<br>
<hr>
<p>В зависимости от заданной костанты WC_MODE, задаются режимы работы:<br>
<p>WC_MODE вкл (раскомментировано) по умолчанию стоит режим №3<br>
1) Пшикаем только по датчику света<br>
2) Пшикаем 1 раз в час, минимальное время включения света - 2.5 минуты<br>
3) -//- каждые 3 часа,<br>
4) -//- каждые 6 часов.<br>
5) Пшикаем 1 раз в час, игнорируя датчик света<br>
6) -//- каждые 3 часа,<br>
7) -//- каждые 6 часов.<br>
<br>
<p>WC_MODE выкл (закомментировано) по умолчанию стоит режим №2<br>
1) Пшикаем 1 раз в час, игнорируя датчик света<br>
2) -//- каждые 3 часа,<br>
3) -//- каждые 6 часов.<br>
4) Пшикаем 1 раз в час, только при включенном свете<br>
5) -//- каждые 3 часа,<br>
6) -//- каждые 6 часов.<br>
7) Пшикаем 1 раз в час, только при выключенном свете<br>
8) -//- каждые 3 часа,<br>
9) -//- каждые 6 часов.<br>
По <a href="https://cxem.net/house/1-464.php">ссылке</a> мой проект на сайте паяльник, там есть первая версия прошивки с возможностью выбора минимального времени включения света.</p>
<p><img src="https://raw.githubusercontent.com/ashelehov/airwick13/master/img/airwick.jpg" alt="airwick"></p>
<p><img src="https://raw.githubusercontent.com/ashelehov/airwick13/master/img/chart.png" alt="chart"></p>
<p><img src="https://raw.githubusercontent.com/ashelehov/airwick13/master/img/test.jpg" alt="test"></p>
<p><img src="https://raw.githubusercontent.com/ashelehov/airwick13/master/img/intro.jpg" alt="intro"></p>
